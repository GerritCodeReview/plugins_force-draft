{
  "comments": [
    {
      "key": {
        "uuid": "4f3169d0_67d1d20d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-26T12:33:19Z",
      "side": 1,
      "message": "To create a draft one has to push to: refs/drafts/branch.\nTo create a normal change one has to push to refs/for/branch.\nIn this change you change a normal change to draft, but only change the status form NEW to DRAFT, preserving the \"wrong\" ref. Should be this mentioned here?",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2f26f59c_66de2ef7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2014-02-27T11:53:27Z",
      "side": 1,
      "message": "I\u0027m not sure I understand you when you say \"the \"wrong\" ref.\". Which ref are we talking about here?\nIf you look at the Publish.updateDraftPatchSet(...) method, for example, it doesn\u0027t seem to update anything but the draft-flag in the db. Force-draft plugin does the reverse operation. Please enlighten me.\n\nprivate PatchSet updateDraftPatchSet(RevisionResource rsrc) throws OrmException {\n    return dbProvider.get().patchSets()\n        .atomicUpdate(rsrc.getPatchSet().getId(),\n        new AtomicUpdate\u003cPatchSet\u003e() {\n      @Override\n      public PatchSet update(PatchSet patchset) {\n        patchset.setDraft(false);\n        return patchset;\n      }\n    });\n  }",
      "parentUuid": "4f3169d0_67d1d20d",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4f3169d0_47f68e74",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-27T13:26:38Z",
      "side": 1,
      "message": "I was wrong, refs/drafts magic branch is only used to mark a new pushed change as a draft:\n\n MagicBranchInput(ReceiveCommand cmd) {\n      this.cmd \u003d cmd;\n      this.draft \u003d cmd.getRefName().startsWith(MagicBranch.NEW_DRAFT_CHANGE);\n    }\n\nBut then, what you are actually doing here is: you are changing the very limited CREATE_DRAFT \u003d\u003e PUBLISH_TO_NEW_CHANGE workflow to: WORK_IN_PROGRESS workflow. Having the ability to toggle the change between READY (new change) and WIP (draft) status is exactly the definition of WIP.\n\nThe only difference between what you are doing here and the WIP approach, that already solved in these two changes [1] and [2] is the visibility issue and ability to delete refs.\n\n* [1] https://gerrit-review.googlesource.com/54088 \n* [2] https://gerrit-review.googlesource.com/50254",
      "parentUuid": "2f26f59c_66de2ef7",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2f26f59c_86f7aa74",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/forcedraft/ForceDraft.java",
        "patchSetId": 4
      },
      "lineNbr": 34,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-27T13:45:19Z",
      "side": 1,
      "message": "So in second thought this restriction doesn\u0027t make any sense to me: enabling only site admins to toggle Draft state: a better approach is to enable the change owner to do that.",
      "range": {
        "startLine": 34,
        "startChar": 0,
        "endLine": 34,
        "endChar": 95
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}