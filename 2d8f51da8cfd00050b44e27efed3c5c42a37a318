{
  "comments": [
    {
      "key": {
        "uuid": "4f3169d0_67d1d20d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-26T12:33:19Z",
      "side": 1,
      "message": "To create a draft one has to push to: refs/drafts/branch.\nTo create a normal change one has to push to refs/for/branch.\nIn this change you change a normal change to draft, but only change the status form NEW to DRAFT, preserving the \"wrong\" ref. Should be this mentioned here?",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2f26f59c_66de2ef7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2014-02-27T11:53:27Z",
      "side": 1,
      "message": "I\u0027m not sure I understand you when you say \"the \"wrong\" ref.\". Which ref are we talking about here?\nIf you look at the Publish.updateDraftPatchSet(...) method, for example, it doesn\u0027t seem to update anything but the draft-flag in the db. Force-draft plugin does the reverse operation. Please enlighten me.\n\nprivate PatchSet updateDraftPatchSet(RevisionResource rsrc) throws OrmException {\n    return dbProvider.get().patchSets()\n        .atomicUpdate(rsrc.getPatchSet().getId(),\n        new AtomicUpdate\u003cPatchSet\u003e() {\n      @Override\n      public PatchSet update(PatchSet patchset) {\n        patchset.setDraft(false);\n        return patchset;\n      }\n    });\n  }",
      "parentUuid": "4f3169d0_67d1d20d",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4f3169d0_47f68e74",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-27T13:26:38Z",
      "side": 1,
      "message": "I was wrong, refs/drafts magic branch is only used to mark a new pushed change as a draft:\n\n MagicBranchInput(ReceiveCommand cmd) {\n      this.cmd \u003d cmd;\n      this.draft \u003d cmd.getRefName().startsWith(MagicBranch.NEW_DRAFT_CHANGE);\n    }\n\nBut then, what you are actually doing here is: you are changing the very limited CREATE_DRAFT \u003d\u003e PUBLISH_TO_NEW_CHANGE workflow to: WORK_IN_PROGRESS workflow. Having the ability to toggle the change between READY (new change) and WIP (draft) status is exactly the definition of WIP.\n\nThe only difference between what you are doing here and the WIP approach, that already solved in these two changes [1] and [2] is the visibility issue and ability to delete refs.\n\n* [1] https://gerrit-review.googlesource.com/54088 \n* [2] https://gerrit-review.googlesource.com/50254",
      "parentUuid": "2f26f59c_66de2ef7",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2f26f59c_a6fca657",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2014-02-27T13:56:58Z",
      "side": 1,
      "message": "The visibility and ability to delete refs were the two requirements for this plugin. So I can not see the problem with this being the only thing separating the functionality of this plugin and the WIP workflow introduced in these two changes.\nOne important,further, difference is that you have to be an administrator to use force-draft. It is not meant to be used as part of the development process. It\u0027s primary goal is to enable administrators to give users the opportunity to delete a change if the administrators find that it is a valid option, as stated in the commit message:\n\"Git-administrators sometimes needs to set PatchSets as draft, to\nenable users to remove PatchSets, for legal or other reasons.\"\nThe requirements are taken from real live cases, our admin group, reluctantly, performed this operation manually prior to this plugin, now they don\u0027t have to.",
      "parentUuid": "4f3169d0_47f68e74",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4f3169d0_c71a7efe",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-27T14:21:28Z",
      "side": 1,
      "message": "i disagree.\n\nSo what you are proposing here is to to add another plugin for another admin group, that discover that this plugin is there and don\u0027t want to be spammed from hundreds of Gerrit users to turn their normal change to draft, and want change owner to do it on their own.\n\nIt doesn\u0027t simple make any sense to me to restrict something that user can do anyway, but haven\u0027t done.\n\nSo without this plugin the use can only do:\n\n git push review HEAD:refs/drafts/master\n\nWith this plugin with administrator right requirement the user can do:\n\n git push review HEAD:refs/heads/master\n \u003copen chat windows\u003e\n PING gerrit admins group\n Hey guys, i messed up with pushing to the wrong magic branch, could you turn it to draft, please …\n You turn it to be draft.\n\nAll what i say is: take [optionally] this chat/ping stuff out of the picture and enable the change owner to do that.",
      "parentUuid": "2f26f59c_a6fca657",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2f26f59c_06ec9aa0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2014-02-27T15:35:14Z",
      "side": 1,
      "message": "Hmmm, I don\u0027t think you can find many medium to large companies that would approve of their developers having the right to delete code that has been pushed, I know we wouldn\u0027t.\nThere are a number of cases that could complicate things, like dependencies on the change from other changes etc.\nIt is a general rule that, if you\u0027re working for a company, you don\u0027t personally own the code you write, therefore it is not yours to delete.\nFurther more I don\u0027t think that having this capability is something that you, as an admin group, would like to broadcast to the entire organization in a \"come get it\" fashion.\nEven without this plugin our admin group was not spared from developers who wanted them to delete changes on the basis that they thought their initial code wasn\u0027t up to par and they did not want other developers to see. They were not successful in their demands.\n\nIf someone feels the need for functionality that enables developers to delete their code, they are free to implement this functionality (maybe in a plugin that displays a nice \"unpublish\" or \"delete\" button in the UI). Because this plugin is not for them.\n\nThis plugin is there to help admins performing a task that they already do manually. That was, and is, the sole purpose of it\u0027s existence.",
      "parentUuid": "4f3169d0_c71a7efe",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8f37e1c2_498221eb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-02-28T01:34:00Z",
      "side": 1,
      "message": "A few points\n\n- The WIP workflow will be in 2.9.  We are running 2.8.x and not sure when/if we will be able to upgrade to 2.9. This was originally implemented against the 2.6 API.\n\n- As Sven has said, we cannot simply allow users to delete changes.\n\n- The requirement for this plugin comes from actual cases where developers have uploaded something that must be removed.  Examples include: 1) user has uploaded huge files that we don\u0027t want in the git repository, even if only on the refs/changes namespace, and 2) user has uploaded proprietary or secret code that for legal reasons must not be stored on our Gerrit server.\n\nThe main reason it\u0027s implemented as a plugin is because it\u0027s a feature that not everyone will want in core Gerrit.  So since it\u0027s a plugin, if you don\u0027t like it, you just don\u0027t install it :)",
      "parentUuid": "2f26f59c_06ec9aa0",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2f26f59c_c61a82fe",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-28T07:01:04Z",
      "side": 1,
      "message": "Thank you both for clarification.",
      "parentUuid": "8f37e1c2_498221eb",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 17,
        "endChar": 21
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2f26f59c_06157acc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2014-02-28T08:25:42Z",
      "side": 1,
      "message": "is it better to let【1】 display in commit message to make it easy to understand?\n\n【1】 “The requirement for this plugin comes from actual cases where developers have uploaded something that must be removed. Examples include: 1) user has uploaded huge files that we don\u0027t want in the git repository, even if only on the refs/changes namespace, and 2) user has uploaded proprietary or secret code that for legal reasons must not be stored on our Gerrit server.”",
      "parentUuid": "2f26f59c_c61a82fe",
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf439932_eb0751e2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 17,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-02-28T08:31:10Z",
      "side": 1,
      "message": "Done.\n\nIt would also be good to have similar information in the about.md file, but that could be done in a follow-up commit.",
      "parentUuid": "2f26f59c_06157acc",
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf439932_8b088df7",
        "filename": "pom.xml",
        "patchSetId": 4
      },
      "lineNbr": 26,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-02-28T07:14:52Z",
      "side": 1,
      "message": "Gah.  We should double-check that this version still works with 2.8.x",
      "range": {
        "startLine": 26,
        "startChar": 11,
        "endLine": 26,
        "endChar": 23
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2f26f59c_86f7aa74",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/forcedraft/ForceDraft.java",
        "patchSetId": 4
      },
      "lineNbr": 34,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-27T13:45:19Z",
      "side": 1,
      "message": "So in second thought this restriction doesn\u0027t make any sense to me: enabling only site admins to toggle Draft state: a better approach is to enable the change owner to do that.",
      "range": {
        "startLine": 34,
        "startChar": 0,
        "endLine": 34,
        "endChar": 95
      },
      "revId": "2d8f51da8cfd00050b44e27efed3c5c42a37a318",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}